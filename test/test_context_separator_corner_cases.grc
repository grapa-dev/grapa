/* Context Separator Corner Case Tests */

"=== CONTEXT SEPARATOR CORNER CASE TESTS ===\n".echo();

/* 1. Adjacent context blocks (should not insert --) */
"Test 1: Adjacent context blocks\n".echo();
input1 = "a\nb\nc\nd\ne\nf";
result1 = input1.grep("c|d", "A1B1");
("Result: " + result1.str() + "\n").echo();
("Expected: All lines c,d and their context, no --\n").echo();
"---\n".echo();

/* 2. Overlapping context blocks (should merge, no --) */
"Test 2: Overlapping context blocks\n".echo();
input2 = "a\nb\nc\nd\ne\nf";
result2 = input2.grep("b|c|d", "A1B1");
("Result: " + result2.str() + "\n").echo();
("Expected: All lines b,c,d and their context, no --\n").echo();
"---\n".echo();

/* 3. Single match at file start (no separator) */
"Test 3: Single match at start\n".echo();
input3 = "match\na\nb\nc";
result3 = input3.grep("match", "A2B1");
("Result: " + result3.str() + "\n").echo();
("Expected: match, a, b\n").echo();
"---\n".echo();

/* 4. Single match at file end (no separator) */
"Test 4: Single match at end\n".echo();
input4 = "a\nb\nmatch";
result4 = input4.grep("match", "A1B2");
("Result: " + result4.str() + "\n").echo();
("Expected: b, match\n").echo();
"---\n".echo();

/* 5. All lines matched (no separator) */
"Test 5: All lines matched\n".echo();
input5 = "a\nb\nc";
result5 = input5.grep(".", "A1B1");
("Result: " + result5.str() + "\n").echo();
("Expected: all lines, no --\n").echo();
"---\n".echo();

/* 6. Invert match with context */
"Test 6: Invert match with context\n".echo();
input6 = "a\nfoo\nb\nbar\nc\nfoo\nd";
result6 = input6.grep("foo", "A1B1v");
("Result: " + result6.str() + "\n").echo();
("Expected: context for non-matching lines, -- between blocks\n").echo();
"---\n".echo();

/* 7. Custom delimiter context */
"Test 7: Custom delimiter context\n".echo();
input7 = "a|b|c|d|e|f";
result7 = input7.grep("c|e", "A1B1", "|");
("Result: " + result7.str() + "\n").echo();
("Expected: context blocks with custom delimiter, -- between blocks\n").echo();
"---\n".echo();

/* 8. Empty input */
"Test 8: Empty input\n".echo();
input8 = "";
result8 = input8.grep(".", "A1B1");
("Result: " + result8.str() + "\n").echo();
("Expected: []\n").echo();
"---\n".echo();

/* 9. JSON output mode (should use --- not --\n) */
"Test 9: JSON output mode\n".echo();
input9 = "a\nb\nc\nd\ne\nf";
result9 = input9.grep("c|f", "A1B1j");
("Result: " + result9.str() + "\n").echo();
("Expected: --- as separator in JSON\n").echo();
"---\n".echo();

/* 10. Match-only mode (should not insert separators) */
"Test 10: Match-only mode\n".echo();
input10 = "a\nb\nc\nd\ne\nf";
result10 = input10.grep("c|f", "A1B1o");
("Result: " + result10.str() + "\n").echo();
("Expected: only matches, no context, no separators\n").echo();
"---\n".echo();

"=== CONTEXT SEPARATOR CORNER CASE TESTS COMPLETE ===\n".echo(); 