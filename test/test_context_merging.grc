/* Context Merging Test */

"=== CONTEXT MERGING TEST ===\n".echo();

/* Test 1: Basic overlapping context */
"Test 1: Basic overlapping context\n".echo();
input = "Line 1\nLine 2\nLine 3\nLine 2\nLine 4\nLine 2\nLine 5";
("Input: " + input + "\n").echo();
("Pattern: Line 2, Options: A1B1\n").echo();
result = input.grep("Line 2", "A1B1");
("Result: " + result.str() + "\n").echo();
("Expected: Should merge overlapping context lines\n").echo();
"---\n".echo();

/* Test 2: Adjacent context blocks */
"Test 2: Adjacent context blocks\n".echo();
input2 = "a\nb\nc\nd\ne\nf";
("Input: " + input2 + "\n").echo();
("Pattern: c|d, Options: A1B1\n").echo();
result2 = input2.grep("c|d", "A1B1");
("Result: " + result2.str() + "\n").echo();
("Expected: All lines c,d and their context, no --\n").echo();
"---\n".echo();

/* Test 3: Overlapping context blocks */
"Test 3: Overlapping context blocks\n".echo();
input3 = "a\nb\nc\nd\ne\nf";
("Input: " + input3 + "\n").echo();
("Pattern: b|c|d, Options: A1B1\n").echo();
result3 = input3.grep("b|c|d", "A1B1");
("Result: " + result3.str() + "\n").echo();
("Expected: All lines b,c,d and their context, no --\n").echo();
"---\n".echo();

/* Test 4: Large context with gaps */
"Test 4: Large context with gaps\n".echo();
input4 = "Header\nLine 1\nLine 2\nLine 3\nLine 4\nLine 5\nLine 2\nLine 6\nLine 7\nLine 8\nLine 9\nLine 2\nLine 10\nFooter";
("Input: " + input4 + "\n").echo();
("Pattern: Line 2, Options: A2B2\n").echo();
result4 = input4.grep("Line 2", "A2B2");
("Result: " + result4.str() + "\n").echo();
("Expected: Should merge overlapping context regions and add -- between non-overlapping\n").echo();
"---\n".echo();

/* Test 5: Invert match with context */
"Test 5: Invert match with context\n".echo();
input5 = "a\nfoo\nb\nbar\nc\nfoo\nd";
("Input: " + input5 + "\n").echo();
("Pattern: foo, Options: A1B1v\n").echo();
result5 = input5.grep("foo", "A1B1v");
("Result: " + result5.str() + "\n").echo();
("Expected: context for non-matching lines, -- between blocks\n").echo();
"---\n".echo();

"=== CONTEXT MERGING TEST COMPLETE ===\n".echo(); 