"Simple ASCII match\n".echo();
input = "hello world\nfoo bar\nbaz qux";
result = input.grep(r"hello", "o");
if (result == ["hello"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Simple ASCII match 2\n".echo();
result = input.grep(r"foo", "o");
if (result == ["foo"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Simple ASCII match 3\n".echo();
result = input.grep(r"qux", "o");
if (result == ["qux"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Non-matching pattern\n".echo();
result = input.grep(r"notfound", "o");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();

"Wildcard match\n".echo();
result = input.grep(r"ba.", "o");
if (result == ["bar", "baz"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Line start anchor\n".echo();
result = input.grep(r"^foo", "om");
if (result == ["foo"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Line end anchor\n".echo();
result = input.grep(r"world$", "o");
if (result == ["world"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Double vowel (should not match)\n".echo();
result = input.grep(r"[aeiou]{2}", "o");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Single vowel match\n".echo();
result = input.grep(r"[aeiou]", "o");
if (result == ["e", "o", "o", "o", "a", "a", "a", "u"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Word boundary test\n".echo();
input = "The quick brown fox jumps over the lazy dog";
result = input.grep(r"quick", "o");
if (result == ["quick"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Case insensitive match\n".echo();
result = input.grep(r"the", "oi");
if (result == ["the", "the"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Character class with space\n".echo();
result = input.grep(r"z.y", "o");
if (result == ["z y"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Word boundary with length\n".echo();
result = input.grep(r"\b\w{3}\b", "o");
if (result == ["The", "fox", "the", "dog"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Line start with multiline\n".echo();
input = "foo\nbar\nbaz\nqux";
result = input.grep(r"^b", "om");
if (result == ["bar", "baz"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Match all lines\n".echo();
result = input.grep(r".*", "om");
if (result == ["foo", "bar", "baz", "qux"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Digit matching\n".echo();
input = "abc123xyz";
result = input.grep(r"\d+", "o");
if (result == ["123"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Word character matching\n".echo();
result = input.grep(r"\w+", "o");
if (result == ["abc123xyz"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Unicode coffee in different scripts\n".echo();
input = "caf\u00e9\ncafe\u0301\nĞºĞ¾Ñ„Ğµ\nÎºÎ±Ï†Î­Ï‚\nå’–å•¡";
result = input.grep(r"caf", "o");
if (result == ["caf", "caf", "caf"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Unicode normalization NFC/NFD\n".echo();
result = input.grep(r"cafÃ©", "o");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Combining accent mark\n".echo();
result = input.grep(r"\u0301", "o");
if (result == ["Ì"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Cyrillic script\n".echo();
result = input.grep(r"ĞºĞ¾Ñ„Ğµ", "o");
if (result == ["ĞºĞ¾Ñ„Ğµ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Greek script\n".echo();
result = input.grep(r"ÎºÎ±Ï†Î­Ï‚", "o");
if (result == ["ÎºÎ±Ï†Î­Ï‚"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"CJK script\n".echo();
result = input.grep(r"å’–å•¡", "o");
if (result == ["å’–å•¡"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Line start with Unicode\n".echo();
result = input.grep(r"^cafe", "om");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Greek line start\n".echo();
result = input.grep(r"^ÎºÎ±", "om");
if (result == ["ÎºÎ±Ï†Î­Ï‚"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"CJK line start\n".echo();
result = input.grep(r"^å’–", "om");
if (result == ["å’–å•¡"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mathematical script\n".echo();
input = "ğ’œğ’·ğ’¸ğ’¹ğ‘’ğ’»";
result = input.grep(r"ğ’¸", "o");
if (result == ["ğ’¸"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mathematical script case\n".echo();
result = input.grep(r"ğ’¶", "o");
if (result == ["ğ’¶"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Spanish n with tilde normalization\n".echo();
input = "maÃ±ana\nmanÌƒana";
result = input.grep(r"maÃ±ana", "o");
if (result == ["maÃ±ana", "manÌƒana"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Combining tilde\n".echo();
result = input.grep(r"nÌƒ", "o");
if (result == ["nÌƒ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Precomposed n with tilde\n".echo();
result = input.grep(r"\u00f1", "o");
if (result == ["Ã±"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Decomposed n with tilde\n".echo();
result = input.grep(r"\u006e\u0303", "o");
if (result == ["nÌƒ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"German sharp S case folding\n".echo();
input = "straÃŸe\nSTRASSE\nStraÃŸe";
result = input.grep(r"straÃŸe", "oi");
if (result == ["straÃŸe", "STRASSE", "StraÃŸe"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Turkish dotted I case folding\n".echo();
input = "Ä°stanbul\nistanbul\nISTANBUL";
result = input.grep(r"istanbul", "oi");
if (result == ["Ä°stanbul", "istanbul", "ISTANBUL"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Hebrew word boundary\n".echo();
input = "×©×œ×•×\n×©Ö¸××œ×•Ö¹×\nÙ…Ø±Ø­Ø¨Ø§\nhello";
result = input.grep(r"\b×©×œ×•×\b", "o");
if (result == ["×©×œ×•×"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Arabic word boundary\n".echo();
result = input.grep(r"\bÙ…Ø±Ø­Ø¨Ø§\b", "o");
if (result == ["Ù…Ø±Ø­Ø¨Ø§"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mixed script word characters\n".echo();
input = "ĞºĞ¾Ñ„Ğµ\nÑ‡Ğ°Ğ¹\n123Ù¤Ù¥Ù¦";
result = input.grep(r"\w+", "o");
if (result == ["ĞºĞ¾Ñ„Ğµ", "Ñ‡Ğ°Ğ¹", "123", "Ù¤Ù¥Ù¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mixed script digits\n".echo();
result = input.grep(r"\d+", "o");
if (result == ["123", "Ù¤Ù¥Ù¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Complex emoji sequences\n".echo();
input = "emoji: ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\nflag: ğŸ‡ºğŸ‡³\nmod: ğŸ‘ğŸ½";
result = input.grep(r"ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "o");
if (result == ["ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Flag emoji\n".echo();
result = input.grep(r"ğŸ‡ºğŸ‡³", "o");
if (result == ["ğŸ‡ºğŸ‡³"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Emoji with modifier\n".echo();
result = input.grep(r"ğŸ‘ğŸ½", "o");
if (result == ["ğŸ‘ğŸ½"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Rare Unicode characters\n".echo();
input = "rare: ğˆ\nmath: ğ’œğ’·ğ’¸";
result = input.grep(r"ğˆ", "o");
if (result == ["ğˆ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mathematical character\n".echo();
result = input.grep(r"ğ’¸", "o");
if (result == ["ğ’¸"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Multiple combining marks\n".echo();
input = "a\u0301\u0323\nÃ¡Ì£";
result = input.grep(r"a\u0301\u0323", "o");
if (result == ["aÌÌ£"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Precomposed with combining marks\n".echo();
result = input.grep(r"Ã¡Ì£", "o");
if (result == ["Ã¡Ì£"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Unicode whitespace\n".echo();
input = "space: \u2003\nnewline:\n";
result = input.grep(r"\s", "o");
if (result == [" ", "\u2003", "\n"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Family emoji sequence\n".echo();
input = "family: ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\nwoman: ğŸ‘©\nman: ğŸ‘¨";
result = input.grep(r"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "o");
if (result == ["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Flag emoji sequences\n".echo();
input = "flag: ğŸ‡¨ğŸ‡¦\nflag: ğŸ‡¯ğŸ‡µ";
result = input.grep(r"ğŸ‡¨ğŸ‡¦", "o");
if (result == ["ğŸ‡¨ğŸ‡¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Japanese flag\n".echo();
result = input.grep(r"ğŸ‡¯ğŸ‡µ", "o");
if (result == ["ğŸ‡¯ğŸ‡µ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Arabic text\n".echo();
input = "arabic: Ù…Ø±Ø­Ø¨Ø§\nhebrew: ×©Ö¸××œ×•Ö¹×";
result = input.grep(r"Ù…Ø±Ø­Ø¨Ø§", "o");
if (result == ["Ù…Ø±Ø­Ø¨Ø§"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Hebrew with diacritics\n".echo();
result = input.grep(r"×©Ö¸××œ×•Ö¹×", "o");
if (result == ["×©Ö¸××œ×•Ö¹×"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Complex emoji with ZWJ\n".echo();
input = "emoji: ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©";
result = input.grep(r"ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©", "o");
if (result == ["ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘©"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Character class: whitespace\n".echo();
input = "a b\tc\u00A0d\u3000e";
result = input.grep(r"\s", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Fuzz: random Unicode (BMP, supplementary, emoji, combining, RTL, etc.)\n".echo();
input = "a\u0301ğŸ˜€ğˆ×©Ö¸××œ×•Ö¹×Ù…Ø±Ø­Ø¨Ø§";
result = input.grep(r".", "ou");
if (result == ["a", "Ì", "ğŸ˜€", "ğˆ", "×©", "Ö¸", "×", "×œ", "×•", "Ö¹", "×", "Ù…", "Ø±", "Ø­", "Ø¨", "Ø§"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Performance: very long line with repeated Unicode\n".echo();
input = "";
i = 0;
while (i < 10000) { input += "ğŸ˜€"; i += 1; }
result = input.grep(r"ğŸ˜€+", "o");
if (result == [input]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Robustness: invalid UTF-8 (should not crash, may return empty or partial)\n".echo();
input = "\xC3\x28";
result = input.grep(r".", "o");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Grapheme cluster: emoji with skin tone and ZWJ\n".echo();
input = "ğŸ‘ğŸ½ ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦";
result = input.grep(r"ğŸ‘ğŸ½", "o");
if (result == ["ğŸ‘ğŸ½"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Family emoji with ZWJ\n".echo();
result = input.grep(r"ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "o");
if (result == ["ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mixed family emoji\n".echo();
result = input.grep(r"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "o");
if (result == ["ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Character class: symbols and currency\n".echo();
input = "$ â‚¬ Â¥ ğ›‘ âˆ‘";
result = input.grep(r"[$â‚¬Â¥]", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: punctuation\n".echo();
input = r".,;:!?\"'â€”";
result = input.grep(r"[.,;:!?\"'â€”]+", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: line and paragraph separators\n".echo();
input = "a\u2028b\u2029c";
result = input.grep("[\u2028\u2029]", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: line and paragraph separators (raw)\n".echo();
input = "a" + "\xE2\x80\xA8" + "b" + "\xE2\x80\xA9" + "c";
result = input.grep("[\xE2\x80\xA8\xE2\x80\xA9]", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Turkish dotted/dotless I case folding\n".echo();
input = "I Ä± Ä° i";
result = input.grep(r"i", "oi");
if (result == ["I", "Ä±", "Ä°", "i"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Greek sigma case folding\n".echo();
input = "Î£ Ïƒ Ï‚";
result = input.grep(r"Ïƒ", "oi");
if (result == ["Î£", "Ïƒ", "Ï‚"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Zero-width joiner in emoji\n".echo();
input = "ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ‘©ğŸ‘©ğŸ‘§ğŸ‘¦";
result = input.grep(r"ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", "o");
if (result == ["ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Bidirectional text\n".echo();
input = "english ×¢×‘×¨×™×ª english";
result = input.grep(r"×¢×‘×¨×™×ª", "o");
if (result == ["×¢×‘×¨×™×ª"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Surrogate pair edge case\n".echo();
input = "\uD83D\uDE00"; 
result = input.grep(r"ğŸ˜€", "o");
if (result == ["ğŸ˜€"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Lone surrogate (should not crash)\n".echo();
input = "\uD83D"; 
result = input.grep(r".", "o");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Word boundary with emoji\n".echo();
input = "ğŸ˜€wordğŸ˜€";
result = input.grep(r"\bword\b", "o");
if (result == ["word"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Line boundary with Unicode\n".echo();
input = "ğŸ˜€\nword\nğŸ˜€";
result = input.grep(r"^word$", "om");
if (result == ["word"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Mixed content performance test\n".echo();
input = "";
i = 0;
while (i < 1000) { if (i % 3 == 0) {input += "ğŸ˜€";} elseif (i % 3 == 1) { input += "cafÃ©"; } else { input += "ĞºĞ¾Ñ„Ğµ"; };i += 1;};
result = input.grep(r"ğŸ˜€", "o");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: letters and word characters\n".echo();
input = "abc Î‘Î’Î“ Ğ°Ğ±Ğ² æ¼¢å­— ğŸ˜€";
result = input.grep(r"\w+", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: digits\n".echo();
input = "123 Ù¤Ù¥Ù¦ à¥§à¥¨à¥© ï¼‘ï¼’ï¼“";
result = input.grep(r"\d+", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Fuzz: long string with mixed scripts and emoji\n".echo();
input = "Latin: abc\nGreek: Î‘Î’Î“\nCyrillic: Ğ°Ğ±Ğ²\nCJK: æ¼¢å­—\nEmoji: ğŸ˜€ğŸ‘ğŸ½ğŸ‡ºğŸ‡³";
result = input.grep(r"\w+", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"Character class: combining marks\n".echo();
input = "a\u0301 e\u0323 o\u0302\u0301";
result = input.grep("[\u0300-\u036F\u1AB0-\u1AFF\u20D0-\u20FF]+", "ou");
if (result.type() != $ERR && result.len() > 0) "PASS\n".echo(); else "FAIL\n".echo();
if (result.type() == $ERR) result.echo();
"---\n".echo();

"All tests completed\n".echo(); 

"Custom delimiter: basic match\n".echo();
input = "hello world|||foo bar|||baz qux";
result = input.grep(r"foo", "o", "|||");
if (result == ["foo"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: match at start, middle, end\n".echo();
input = "start|||middle|||end";
result = input.grep(r"start", "o", "|||");
if (result == ["start"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"end", "o", "|||");
if (result == ["end"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: trailing delimiter\n".echo();
input = "foo|||bar|||";
result = input.grep(r"bar", "o", "|||");
if (result == ["bar"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: multi-character with regex special chars\n".echo();
input = "a.b|c.d|e.f";
result = input.grep(r"c.d", "o", "|");
if (result == ["c.d"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: no matches\n".echo();
input = "foo|||bar|||baz";
result = input.grep(r"qux", "o", "|||");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: delimiter not present in input\n".echo();
input = "foo bar baz";
result = input.grep(r"foo", "o", "|||");
if (result == ["foo"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Custom delimiter: empty delimiter (should default to newline)\n".echo();
input = "foo\nbar\nbaz";
result = input.grep(r"bar", "o", "");
if (result == ["bar"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo(); 

"Explicit normalization: NONE (should not match decomposed with composed)\n".echo();
input = "cafe\u00e9\ncafe\u00e9";
result = input.grep(r"cafÃ©", "o", "", "NONE");
if (result == ["cafÃ©"]) "PASS\n".echo(); else "FAIL\n".echo();
input = "cafe\u00e9\ncafe\u00e9";
result = input.grep(r"cafe\u0301", "o", "", "NONE");
if (result == []) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Explicit normalization: NFC (should match composed and decomposed)\n".echo();
input = "cafÃ©\ncafe\u0301";
result = input.grep(r"cafÃ©", "o", "", "NFC");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"cafe\u0301", "o", "", "NFC");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Explicit normalization: NFD (should match composed and decomposed)\n".echo();
input = "cafÃ©\ncafe\u0301";
result = input.grep(r"cafÃ©", "o", "", "NFD");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"cafe\u0301", "o", "", "NFD");
if (result == ["cafÃ©", "cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Explicit normalization: NFKC (should match compatibility forms)\n".echo();
input = "A\n\u212B";
result = input.grep(r"Ã…", "o", "", "NFKC");
if (result == ["Ã…", "â„«"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"\u212B", "o", "", "NFKC");
if (result == ["Ã…", "â„«"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Explicit normalization: NFKD (should match compatibility forms)\n".echo();
input = "Ã…\u212B";
result = input.grep(r"Ã…", "o", "", "NFKD");
if (result == ["Ã…", "â„«"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"\u212B", "o", "", "NFKD");
if (result == ["Ã…", "â„«"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo(); 

"Hex output: ASCII character\n".echo();
if ("A".hex() == "41") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Latin-1 Supplement (Ã©)\n".echo();
if ("Ã©".hex() == "C3A9") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: BMP CJK character (æ¼¢)\n".echo();
if ("æ¼¢".hex() == "E6BCA2") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Emoji (ğŸ˜€)\n".echo();
if ("ğŸ˜€".hex() == "F09F9880") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Emoji with skin tone (ğŸ‘ğŸ½)\n".echo();
if ("ğŸ‘ğŸ½".hex() == "F09F918DF09F8FBD") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: ZWJ sequence (ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦)\n".echo();
if ("ğŸ‘©â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦".hex() == "F09F91A9E2808DF09F91A9E2808DF09F91A7E2808DF09F91A6") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: ZWJ sequence (ğŸ‘©â€ğŸ‘©â€)\n".echo();
if ("ğŸ‘©â€ğŸ‘©â€".hex() == "F09F91A9E2808DF09F91A9E2808D") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Combining mark (aÌ)\n".echo();
if ("a\u0301".hex() == "61CC81") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: RTL character (×)\n".echo();
if ("×".hex() == "D790") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Surrogate pair (U+1F4A9, ğŸ’©)\n".echo();
if ("ğŸ’©".hex() == "F09F92A9") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Multiple scripts (Aæ¼¢ğŸ˜€)\n".echo();
if ("Aæ¼¢ğŸ˜€".hex() == "41E6BCA2F09F9880") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Flag emoji (ğŸ‡ºğŸ‡³)\n".echo();
if ("ğŸ‡ºğŸ‡³".hex() == "F09F87BAF09F87B3") "PASS\n".echo(); else "FAIL\n".echo();

"Hex output: Family emoji (ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦)\n".echo();
if ("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦".hex() == "F09F91A8E2808DF09F91A9E2808DF09F91A7E2808DF09F91A6") "PASS\n".echo(); else "FAIL\n".echo(); 

"Binary mode: composed vs decomposed Ã© (should only match exact bytes)\n".echo();
input = "cafÃ©\ncafe\u0301";
result = input.grep(r"cafÃ©", "o", "", "NONE", "BINARY");
if (result == ["cafÃ©"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"cafe\u0301", "o", "", "NONE", "BINARY");
if (result == ["cafeÌ"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Binary mode: Unicode word boundary is ASCII-only\n".echo();
input = "ĞºĞ¾Ñ„Ğµ\ncafe\n123";
result = input.grep(r"\b\w+\b", "o", "", "NONE", "BINARY");
if (result == ["cafe", "123"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Binary mode: emoji is matched as bytes, not grapheme\n".echo();
input = "emoji: ğŸ˜€";
result = input.grep(r"ğŸ˜€", "o", "", "NONE", "BINARY");
if (result == ["ğŸ˜€"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r".", "o", "", "NONE", "BINARY");
if (result == ["e", "m", "o", "j", "i", ":", " ", "\xF0", "\x9F", "\x98", "\x80"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Binary mode: combining marks are not combined\n".echo();
input = "a\u0301";
result = input.grep(r"a", "o", "", "NONE", "BINARY");
if (result == ["a"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"\u0301", "o", "", "NONE", "BINARY");
if (result == ["Ì"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo();

"Binary mode: ASCII case-insensitive works, Unicode does not\n".echo();
input = "straÃŸe\nSTRASSE\nStraÃŸe";
result = input.grep(r"straÃŸe", "oi", "", "NONE", "BINARY");
if (result == ["straÃŸe"]) "PASS\n".echo(); else "FAIL\n".echo();
result = input.grep(r"STRASSE", "oi", "", "NONE", "BINARY");
if (result == ["STRASSE"]) "PASS\n".echo(); else "FAIL\n".echo();
"---\n".echo(); 

"JSON output: named groups and offsets\n".echo();
input = "2023-04-27\n2022-12-31";
result = input.grep(r"(?<year>\\d{4})-(?<month>\\d{2})-(?<day>\\d{2})", "oj");
expected = '[{"match":"2023-04-27","year":"2023","month":"04","day":"27","offset":0,"line":1},{"match":"2022-12-31","year":"2022","month":"12","day":"31","offset":11,"line":2}]';
if (result[0] == expected) "PASS\n".echo(); else { "FAIL\n".echo(); result[0].echo(); }
"---\n".echo();

"JSON output: no named groups\n".echo();
input = "foo bar\nbaz qux";
result = input.grep(r"ba.", "oj");
expected = '[{"match":"bar","offset":4,"line":1},{"match":"baz","offset":8,"line":2}]';
if (result[0] == expected) "PASS\n".echo(); else { "FAIL\n".echo(); result[0].echo(); }
"---\n".echo();

"JSON output: Unicode and line numbers\n".echo();
input = "cafÃ©\ncafe\u0301";
result = input.grep(r"cafÃ©", "oj");
expected = '[{"match":"cafÃ©","offset":0,"line":1}]';
if (result[0] == expected) "PASS\n".echo(); else { "FAIL\n".echo(); result[0].echo(); }
"---\n".echo(); 



